<div class="page-container">
  <div class="page-header">
    <div class="header-content">
      <h1>๐ฅ ุฃูุงูุฑ ุงูุชูุฑูุฏ ุงููุฎุฒูู</h1>
      <p>ุฅุฏุงุฑุฉ ุนูููุงุช ุฅุฏุฎุงู ุงูุจุถุงุฆุน ูููุฎุงุฒู</p>
    </div>
  </div>

  <div class="toolbar">
    <button class="btn-primary" (click)="openModal()">
      โ ุฅุถุงูุฉ ุฃูุฑ ุชูุฑูุฏ
    </button>
  </div>

  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>ุฑูู ุงูุฃูุฑ</th>
          <th>ุงููุฎุฒู</th>
          <th>ุงูุชุงุฑูุฎ</th>
          <th>ุงููุฑุฌุน</th>
          <th>ุงูููุฑุฏ/ุงูุญุณุงุจ</th>
          <th>ุงูุฅุฌูุงูู</th>
          <th>ุงูุญุงูุฉ</th>
          <th>ุงูุฅุฌุฑุงุกุงุช</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let transaction of transactions" style="cursor: pointer;" (click)="viewDetails(transaction.id!)">
          <td><a [routerLink]="['/inventory/stock-transaction', transaction.id]" (click)="$event.stopPropagation()" style="color: #007bff; text-decoration: none;">{{ transaction.transactionNumber }}</a></td>
          <td>{{ transaction.warehouseName }}</td>
          <td>{{ transaction.transactionDate | date:'yyyy-MM-dd' }}</td>
          <td>{{ transaction.referenceNumber || '-' }}</td>
          <td>{{ transaction.supplierName || transaction.paymentAccountName || '-' }}</td>
          <td class="amount">{{ transaction.totalAmount | number:'1.2-2' }}</td>
          <td>
            <span class="status-badge" [class.active]="transaction.isApproved">
              {{ transaction.isApproved ? 'ูุนุชูุฏ' : 'ููุฏ ุงููุฑุงุฌุนุฉ' }}
            </span>
          </td>
          <td>
            <button class="btn-icon" (click)="deleteTransaction(transaction.id!)" title="ุญุฐู">๐๏ธ</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="transactions.length === 0" class="empty-state">
    <p>ูุง ุชูุฌุฏ ุฃูุงูุฑ ุชูุฑูุฏ</p>
  </div>
</div>

<!-- Modal -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content large-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>ุฅุถุงูุฉ ุฃูุฑ ุชูุฑูุฏ ุฌุฏูุฏ</h2>
      <button class="btn-close" (click)="closeModal()">โ</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>ุงููุฎุฒู *</label>
          <select [(ngModel)]="currentTransaction.warehouseId" class="form-control">
            <option [ngValue]="0">ุงุฎุชุฑ ุงููุฎุฒู...</option>
            <option *ngFor="let warehouse of warehouses" [ngValue]="warehouse.id">
              {{ warehouse.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>ุงูุชุงุฑูุฎ *</label>
          <input type="date" [(ngModel)]="currentTransaction.transactionDate" class="form-control">
        </div>

        <div class="form-group">
          <label>ุฑูู ุงููุฑุฌุน</label>
          <input type="text" [(ngModel)]="currentTransaction.referenceNumber" 
                 placeholder="ุฑูู ูุงุชูุฑุฉ ุงูููุฑุฏ..." class="form-control">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>ููุน ุงูุฏูุน *</label>
          <select [(ngModel)]="currentTransaction.paymentType" (change)="onPaymentTypeChange()" class="form-control">
            <option value="supplier">ููุฑุฏ</option>
            <option value="account">ุญุณุงุจ ูุจุงุดุฑ</option>
          </select>
        </div>

        <div class="form-group" *ngIf="currentTransaction.paymentType === 'supplier'">
          <label>ุงูููุฑุฏ</label>
          <select [(ngModel)]="currentTransaction.supplierId" class="form-control">
            <option [ngValue]="undefined">ุงุฎุชุฑ ุงูููุฑุฏ...</option>
            <option *ngFor="let supplier of suppliers" [ngValue]="supplier.id">
              {{ supplier.name }}
            </option>
          </select>
        </div>

        <div class="form-group" *ngIf="currentTransaction.paymentType === 'account'">
          <label>ุงูุญุณุงุจ</label>
          <select [(ngModel)]="currentTransaction.paymentAccountId" class="form-control">
            <option [ngValue]="undefined">ุงุฎุชุฑ ุงูุญุณุงุจ...</option>
            <option *ngFor="let account of accounts" [ngValue]="account.id">
              {{ account.code }} - {{ account.name }}
            </option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>ููุงุญุธุงุช</label>
        <textarea [(ngModel)]="currentTransaction.notes" 
                  placeholder="ููุงุญุธุงุช..." class="form-control" rows="2"></textarea>
      </div>

      <hr>
      <h3>ุงูุฃุตูุงู</h3>

      <div class="form-row">
        <div class="form-group">
          <label>ุงูุตูู</label>
          <select [(ngModel)]="newItem.itemId" class="form-control">
            <option [ngValue]="0">ุงุฎุชุฑ ุงูุตูู...</option>
            <option *ngFor="let item of items" [ngValue]="item.id">
              {{ item.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>ุงููููุฉ</label>
          <input type="number" [(ngModel)]="newItem.quantity" 
                 (input)="calculateItemTotal()" class="form-control">
        </div>

        <div class="form-group">
          <label>ุณุนุฑ ุงููุญุฏุฉ</label>
          <input type="number" [(ngModel)]="newItem.unitPrice" 
                 (input)="calculateItemTotal()" class="form-control">
        </div>

        <div class="form-group">
          <label>ุงูุฅุฌูุงูู</label>
          <input type="number" [value]="newItem.totalPrice" readonly class="form-control">
        </div>

        <div class="form-group" style="align-self: flex-end;">
          <button class="btn-primary" (click)="addItem()">ุฅุถุงูุฉ</button>
        </div>
      </div>

      <table class="data-table" *ngIf="currentTransaction.items.length > 0">
        <thead>
          <tr>
            <th>ุงูุตูู</th>
            <th>ุงููููุฉ</th>
            <th>ุงูุณุนุฑ</th>
            <th>ุงูุฅุฌูุงูู</th>
            <th>ุฅุฌุฑุงุก</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of currentTransaction.items; let i = index">
            <td>{{ item.itemName }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.unitPrice | number:'1.2-2' }}</td>
            <td>{{ item.totalPrice | number:'1.2-2' }}</td>
            <td>
              <button class="btn-icon" (click)="removeItem(i)">๐๏ธ</button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3" style="text-align: right;"><strong>ุงูุฅุฌูุงูู ุงูููู:</strong></td>
            <td colspan="2"><strong>{{ getTotalAmount() | number:'1.2-2' }}</strong></td>
          </tr>
        </tfoot>
      </table>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeModal()">ุฅูุบุงุก</button>
      <button class="btn-primary" (click)="saveTransaction()">ุญูุธ</button>
    </div>
  </div>
</div>
