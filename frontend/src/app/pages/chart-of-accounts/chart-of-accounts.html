<div class="chart-container">
  <div class="header">
    <h1>๐ ุงูุฏููู ุงููุญุงุณุจู</h1>
    <p class="subtitle">ุฅุฏุงุฑุฉ ุดุฌุฑุฉ ุงูุญุณุงุจุงุช ุงููุญุงุณุจูุฉ</p>
  </div>

  <div class="toolbar">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="๐ ุงูุจุญุซ ูู ุงูุญุณุงุจุงุช..." 
        [(ngModel)]="searchTerm"
        (input)="filterAccounts()"
      />
    </div>
    
    <button class="btn-primary" (click)="openAddDialog()">
      โ ุฅุถุงูุฉ ุญุณุงุจ ุฑุฆูุณู
    </button>
  </div>

  <div class="accounts-grid">
    @for (account of filteredAccounts; track account.id) {
      <div class="account-card" [class.has-children]="account.children && account.children.length > 0">
        <div class="account-header" (click)="toggleAccount(account)">
          <div class="account-info">
            <span class="account-code">{{ account.code }}</span>
            <span class="account-name">{{ account.name }}</span>
            <span class="account-type" [class]="'type-' + account.type">{{ getTypeLabel(account.type) }}</span>
            @if (account.subType) {
              <span class="account-subtype">{{ getSubTypeLabel(account.subType) }}</span>
            }
          </div>
          
          <div class="account-actions">
            <button class="btn-icon" (click)="openAddSubDialog(account, $event)" title="ุฅุถุงูุฉ ุญุณุงุจ ูุฑุนู">
              โ
            </button>
            <button class="btn-icon" (click)="editAccount(account, $event)" title="ุชุนุฏูู">
              โ๏ธ
            </button>
            <button class="btn-icon btn-danger" (click)="deleteAccount(account, $event)" title="ุญุฐู">
              ๐๏ธ
            </button>
            @if (account.children && account.children.length > 0) {
              <span class="toggle-icon" [class.open]="account.expanded">โผ</span>
            }
          </div>
        </div>

        @if (account.expanded && account.children && account.children.length > 0) {
          <div class="sub-accounts">
            @for (child of account.children; track child.id) {
              <div class="sub-account">
                <div class="sub-account-info">
                  <span class="account-code">{{ child.code }}</span>
                  <span class="account-name">{{ child.name }}</span>
                  <span class="account-type" [class]="'type-' + child.type">{{ getTypeLabel(child.type) }}</span>
                  @if (child.subType) {
                    <span class="account-subtype">{{ getSubTypeLabel(child.subType) }}</span>
                  }
                </div>
                <div class="account-actions">
                  <button class="btn-icon" (click)="editAccount(child, $event)" title="ุชุนุฏูู">
                    โ๏ธ
                  </button>
                  <button class="btn-icon btn-danger" (click)="deleteAccount(child, $event)" title="ุญุฐู">
                    ๐๏ธ
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </div>
    }
  </div>

  @if (filteredAccounts.length === 0) {
    <div class="empty-state">
      <p>๐ ูุง ุชูุฌุฏ ุญุณุงุจุงุช ูุญุงุณุจูุฉ</p>
      <button class="btn-primary" (click)="openAddDialog()">
        ุฅุถุงูุฉ ุฃูู ุญุณุงุจ
      </button>
    </div>
  }
</div>

@if (showDialog) {
  <div class="dialog-overlay" (click)="closeDialog()">
    <div class="dialog" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <h2>{{ dialogMode === 'add' ? 'โ ุฅุถุงูุฉ ุญุณุงุจ' : 'โ๏ธ ุชุนุฏูู ุญุณุงุจ' }}</h2>
        <button class="btn-close" (click)="closeDialog()">โ</button>
      </div>
      
      <div class="dialog-body">
        <div class="form-row">
          <div class="form-group">
            <label>ุฑูู ุงูุญุณุงุจ *</label>
            <input 
              type="text" 
              [(ngModel)]="currentAccount.code" 
              placeholder="ูุซุงู: 1000"
              [disabled]="dialogMode === 'edit'"
            />
          </div>

          <div class="form-group">
            <label>ุฑูู ุงูุชุฑุชูุจ *</label>
            <input 
              type="number" 
              [(ngModel)]="currentAccount.sortOrder" 
              placeholder="1"
              min="1"
            />
          </div>
        </div>

        <div class="form-group">
          <label>ุงุณู ุงูุญุณุงุจ *</label>
          <input 
            type="text" 
            [(ngModel)]="currentAccount.name" 
            placeholder="ูุซุงู: ุงูุฃุตูู ุงููุชุฏุงููุฉ"
          />
        </div>

        <div class="form-group">
          <label>ููุน ุงูุญุณุงุจ *</label>
          <select [(ngModel)]="currentAccount.type">
            <option value="asset">ุฃุตูู</option>
            <option value="liability">ุฎุตูู</option>
            <option value="equity">ุญููู ููููุฉ</option>
            <option value="revenue">ุฅูุฑุงุฏุงุช</option>
            <option value="expense">ูุตุฑููุงุช</option>
          </select>
        </div>

        <div class="form-group">
          <label>ูุณุชูู ุงูุญุณุงุจ *</label>
          <select [(ngModel)]="currentAccount.accountLevel" (change)="onAccountLevelChange()">
            <option value="main">ุฑุฆูุณู</option>
            <option value="sub">ูุฑุนู</option>
          </select>
        </div>

        @if (currentAccount.accountLevel === 'sub') {
          <div class="form-group">
            <label>ุงูุญุณุงุจ ุงูุฃุจ *</label>
            <select [(ngModel)]="currentAccount.parentId">
              <option [value]="undefined">-- ุงุฎุชุฑ ุงูุญุณุงุจ ุงูุฃุจ --</option>
              @for (acc of getAllAccountsFlat(); track acc.id) {
                <option [value]="acc.id">
                  {{ 'โ'.repeat(acc.level || 0) }} {{ acc.code }} - {{ acc.name }}
                </option>
              }
            </select>
          </div>

          <div class="form-group">
            <label>ููุน ุงูุญุณุงุจ ุงููุฑุนู *</label>
            <select [(ngModel)]="currentAccount.subType">
              <option value="general">ุนุงู</option>
              <option value="cash">ุตูุฏูู</option>
              <option value="bank">ุจูู</option>
              <option value="supplier">ููุฑุฏ</option>
              <option value="customer">ุนููู</option>
              <option value="inventory">ูุฎุฒู</option>
            </select>
          </div>

          <div class="form-group">
            <label>ูุฌููุนุฉ ุงูุญุณุงุจุงุช (ุงุฎุชูุงุฑู)</label>
            <select [(ngModel)]="currentAccount.groupId">
              <option [value]="undefined">-- ุจุฏูู ูุฌููุนุฉ --</option>
              @for (group of accountGroups; track group.id) {
                <option [value]="group.id">{{ group.code }} - {{ group.name }}</option>
              }
            </select>
          </div>
        }

        @if (parentAccount) {
          <div class="parent-info">
            <strong>ุงูุญุณุงุจ ุงูุฃุจ:</strong> {{ parentAccount.code }} - {{ parentAccount.name }}
          </div>
        }
      </div>

      <div class="dialog-footer">
        <button class="btn-secondary" (click)="closeDialog()">ุฅูุบุงุก</button>
        <button class="btn-primary" (click)="saveAccount()">
          {{ dialogMode === 'add' ? 'ุฅุถุงูุฉ' : 'ุญูุธ' }}
        </button>
      </div>
    </div>
  </div>
}
