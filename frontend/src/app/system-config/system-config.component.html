<div class="system-config-container">
  <div class="page-header">
    <h1>تهيئة النظام</h1>
    <p>إدارة الشركات والوحدات والفروع</p>
  </div>

  <div class="config-layout">
    <!-- Companies Section -->
    <div class="config-section">
      <div class="section-header">
        <h2>الشركات</h2>
        <button class="btn btn-primary" (click)="openCompanyModal()">
          <i class="fas fa-plus"></i> إضافة شركة
        </button>
      </div>
      
      <div class="companies-list">
        <div *ngFor="let company of companies" 
             class="company-card"
             [class.active]="selectedCompany?.id === company.id"
             (click)="selectCompany(company)">
          <div class="company-info">
            <h3>{{ company.name }}</h3>
            <p *ngIf="company.commercialRegister">السجل التجاري: {{ company.commercialRegister }}</p>
            <p *ngIf="company.address">{{ company.address }}</p>
          </div>
          <div class="company-actions">
            <button class="btn-icon" (click)="openCompanyModal(company); $event.stopPropagation()">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-icon btn-danger" (click)="deleteCompany(company.id); $event.stopPropagation()">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Units Section -->
    <div class="config-section" *ngIf="selectedCompany">
      <div class="section-header">
        <h2>الوحدات</h2>
        <button class="btn btn-primary" (click)="openUnitModal()">
          <i class="fas fa-plus"></i> إضافة وحدة
        </button>
      </div>
      
      <div class="units-list">
        <div *ngFor="let unit of units" 
             class="unit-card"
             [class.active]="selectedUnit?.id === unit.id"
             (click)="selectUnit(unit)">
          <div class="unit-info">
            <h3>{{ unit.name }}</h3>
            <div class="modules-badges">
              <span *ngFor="let module of unit.enabledModules" class="badge">
                {{ getModuleName(module) }}
              </span>
            </div>
          </div>
          <div class="unit-actions">
            <button class="btn-icon" (click)="openUnitModal(unit); $event.stopPropagation()">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-icon btn-danger" (click)="deleteUnit(unit.id); $event.stopPropagation()">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Branches Section -->
    <div class="config-section" *ngIf="selectedUnit">
      <div class="section-header">
        <h2>الفروع</h2>
        <button class="btn btn-primary" (click)="openBranchModal()">
          <i class="fas fa-plus"></i> إضافة فرع
        </button>
      </div>
      
      <div class="branches-list">
        <div *ngFor="let branch of branches" class="branch-card">
          <div class="branch-info">
            <h3>{{ branch.name }}</h3>
            <p *ngIf="branch.address">{{ branch.address }}</p>
            <p *ngIf="branch.phone">{{ branch.phone }}</p>
          </div>
          <div class="branch-actions">
            <button class="btn-icon" (click)="openBranchModal(branch)">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-icon btn-danger" (click)="deleteBranch(branch.id)">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        
        <div *ngIf="branches.length === 0" class="empty-state">
          <p>لا توجد فروع لهذه الوحدة</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Company Modal -->
<div class="modal" *ngIf="showCompanyModal" (click)="closeCompanyModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ companyForm.id ? 'تعديل الشركة' : 'إضافة شركة جديدة' }}</h2>
      <button class="close-btn" (click)="closeCompanyModal()">×</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group">
        <label>اسم الشركة *</label>
        <input type="text" [(ngModel)]="companyForm.name" class="form-control" required>
      </div>
      
      <div class="form-group">
        <label>السجل التجاري</label>
        <input type="text" [(ngModel)]="companyForm.commercialRegister" class="form-control">
      </div>
      
      <div class="form-group">
        <label>الرقم الضريبي</label>
        <input type="text" [(ngModel)]="companyForm.taxNumber" class="form-control">
      </div>
      
      <div class="form-group">
        <label>العنوان</label>
        <textarea [(ngModel)]="companyForm.address" class="form-control" rows="2"></textarea>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>الهاتف</label>
          <input type="text" [(ngModel)]="companyForm.phone" class="form-control">
        </div>
        
        <div class="form-group">
          <label>البريد الإلكتروني</label>
          <input type="email" [(ngModel)]="companyForm.email" class="form-control">
        </div>
      </div>
      
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="companyForm.isActive">
          <span>نشط</span>
        </label>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeCompanyModal()">إلغاء</button>
      <button class="btn btn-primary" (click)="saveCompany()">حفظ</button>
    </div>
  </div>
</div>

<!-- Unit Modal -->
<div class="modal" *ngIf="showUnitModal" (click)="closeUnitModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ unitForm.id ? 'تعديل الوحدة' : 'إضافة وحدة جديدة' }}</h2>
      <button class="close-btn" (click)="closeUnitModal()">×</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group">
        <label>اسم الوحدة *</label>
        <input type="text" [(ngModel)]="unitForm.name" class="form-control" required>
      </div>
      
      <div class="form-group">
        <label>الوصف</label>
        <textarea [(ngModel)]="unitForm.description" class="form-control" rows="2"></textarea>
      </div>
      
      <div class="form-group">
        <label>الوحدات المفعلة</label>
        <div class="modules-grid">
          <label *ngFor="let module of availableModules" class="module-checkbox">
            <input type="checkbox" 
                   [checked]="isModuleEnabled(module.id)"
                   (change)="toggleModule(module.id)">
            <span>{{ module.name }}</span>
          </label>
        </div>
      </div>
      
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="unitForm.isActive">
          <span>نشط</span>
        </label>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeUnitModal()">إلغاء</button>
      <button class="btn btn-primary" (click)="saveUnit()">حفظ</button>
    </div>
  </div>
</div>

<!-- Branch Modal -->
<div class="modal" *ngIf="showBranchModal" (click)="closeBranchModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ branchForm.id ? 'تعديل الفرع' : 'إضافة فرع جديد' }}</h2>
      <button class="close-btn" (click)="closeBranchModal()">×</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group">
        <label>اسم الفرع *</label>
        <input type="text" [(ngModel)]="branchForm.name" class="form-control" required>
      </div>
      
      <div class="form-group">
        <label>الوصف</label>
        <textarea [(ngModel)]="branchForm.description" class="form-control" rows="2"></textarea>
      </div>
      
      <div class="form-group">
        <label>العنوان</label>
        <textarea [(ngModel)]="branchForm.address" class="form-control" rows="2"></textarea>
      </div>
      
      <div class="form-group">
        <label>الهاتف</label>
        <input type="text" [(ngModel)]="branchForm.phone" class="form-control">
      </div>
      
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="branchForm.isActive">
          <span>نشط</span>
        </label>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeBranchModal()">إلغاء</button>
      <button class="btn btn-primary" (click)="saveBranch()">حفظ</button>
    </div>
  </div>
</div>
